# ~/.config/picom/picom.conf

#################################
#       Backend & VSync         #
#################################

# Backend to use: "glx", "xrender", or "xr_glx_hybrid".
# GLX backend is generally recommended for modern GPUs for better performance.
backend = "glx";

# Enable VSync. Most users want this to prevent screen tearing.
# If you experience stuttering or performance issues, try setting it to false.
vsync = true;

# Try to unredirect if a window takes up the entire screen.
# This can help improve performance when a fullscreen application (like a game or video) is running,
# as Picom will temporarily bypass compositing.
unredir-if-possible = true;

# GLX backend specific options (only relevant if backend = "glx")
glx-no-stencil = true;
glx-copy-from-front = false;
glx-no-rebind-pixmap = true;
# glx-use-copysubbuffermesa = true; # May improve performance on Mesa drivers, but can cause issues on some systems. Test if needed.


#################################
#           Shadows             #
#################################

# Enable client-side shadows on windows.
shadow = true;

# The blur radius for shadows. (Default: 12)
# Smaller values make shadows sharper, larger values make them softer.
shadow-radius = 12;

# The left offset for shadows. (Default: -15)
shadow-offset-x = -15;

# The top offset for shadows. (Default: -15)
shadow-offset-y = -15;

# The opacity of shadows. (0.0 - 1.0, Default: 0.75)
shadow-opacity = 0.7;

# Color of the shadow. (Default: #000000)
# shadow-color = "#000000";

# Exclude shadows for specific windows (e.g., notifications, docks, specific applications).
# This can prevent visual glitches or unnecessary shadows.
# Use 'xprop' in a terminal and click on a window to find its class_g, name, or window_type.
shadow-exclude = [
  "name = 'Notification'",        # Common for notifications
  "class_g = 'Conky'",            # Conky desktop widgets
  "class_g = 'Cairo-dock'",       # Cairo-Dock
  "class_g = 'Xfce4-notifyd'",    # XFCE's notification daemon
  "class_g = 'Polybar'",          # Polybar
  "class_g = 'rofi'",             # Rofi menu
  "class_g = 'dmenu'",            # dmenu
  "class_g = 'slop'",             # slop (used for screenshot selection)
  "class_g = 'Plank'",            # Plank dock
  "_GTK_FRAME_EXTENTS@:c",        # Prevents shadows on CSD/client-side decorated windows where the shadow is drawn by the app itself
  "window_type = 'dock'",         # Docks/panels
  "window_type = 'desktop'",      # Desktop background
  "window_type = 'toolbar'",
  "window_type = 'menu'",
  "window_type = 'utility'",
  "window_type = 'splash'",
  "window_type = 'dialog'",       # Some dialogs might have their own shadows
  "window_type = 'popup_menu'",   # Context menus
  "window_type = 'dropdown_menu'",
  "window_type = 'tooltip'",
  "class_g = 'Steam' && window_type = 'tooltip'", # Specific Steam tooltips
  "class_g = 'kitty' && window_type = 'dialog'", # For kitty's config menu, if it appears
];


#################################
#       Opacity & Fading        #
#################################

# Opacity of inactive windows. (0.1 - 1.0, Default: 1.0)
inactive-opacity = 0.9;

# Dim inactive windows. (0.0 - 1.0, Default: 0.0)
# inactive-dim = 0.1; # Uncomment to enable a subtle dimming effect.

# Opacity of window titlebars and borders. (0.1 - 1.0, Disabled by default)
# frame-opacity = 0.8; # Uncomment to enable transparency for window frames.

# Enable fading when windows open/close/focus.
fading = true;

# Opacity change between steps while fading in. (0.01 - 1.0, Default: 0.028)
fade-in-step = 0.03;

# Opacity change between steps while fading out. (0.01 - 1.0, Default: 0.03)
fade-out-step = 0.03;

# The time between steps in fade step, in milliseconds. (> 0, Default: 10)
fade-delta = 10;

# Do not fade on window open/close.
# no-fading-openclose = true;

# Exclude fading for specific windows (similar to shadow-exclude).
fade-exclude = [ ];


#################################
#            Blurring           #
#################################

# Blur background of semi-transparent / ARGB windows.
# Good for terminals, app launchers etc. Performance varies by backend and GPU.
blur-background = true;

# Blur method. "kawase" is generally good for speed and quality.
# Other options: "kernel" (requires blur-kern), "gaussian" (older/simpler)
blur-method = "dual_kawase"; # Or "kawase", or "kernel"

# Blur strength for "kawase" or "dual_kawase" method. (Default: 5)
blur-strength = 7;

# Specify a blur convolution kernel for "kernel" method (e.g., "3x3box", "5x5gaussian").
# blur-kern = "7x7gaussian";

# Exclude blurring for specific windows.
blur-background-exclude = [
  "window_type = 'desktop'",
  "window_type = 'dock'",
  "window_type = 'dropdown_menu'",
  "window_type = 'popup_menu'",
  "class_g = 'slop'",
  "class_g = 'peek'", # Screen recorder
  "_GTK_FRAME_EXTENTS@:c", # Prevents blur on CSD windows that draw their own background
];


#################################
#       Rounded Corners         #
#################################

# Enable rounded corners for windows.
# This requires a Picom fork with rounded corner support (e.g., `picom-ibhagwan-git`).
# If you don't have a fork with this feature, leave it commented or set to 0.
# corner-radius = 10; # Radius of rounded corners. (Default: 0)

# Exclude rounded corners for specific windows.
# rounded-corners-exclude = [
#   "window_type = 'dock'",
#   "window_type = 'desktop'",
#   "class_g = 'Polybar'",
# ];


#################################
#           General             #
#################################

# Enable or disable client-side decorations (CSD) on all windows.
# Generally, leave this at 'false' unless you have specific CSD issues.
# detect-client-opacity = true; # Not usually needed with modern Picom.

# Use WM_TRANSIENT_FOR to group windows, and consider windows in the same group focused at the same time.
# This helps with dialogs staying on top and correctly receiving focus.
detect-transient = true;

# Use WM_CLIENT_LEADER to group windows, and consider windows from the same application focused or unfocused at the same time.
# Useful for multi-window applications (e.g., GIMP).
detect-client-leader = true;

# Focus exclude: windows that should always be considered focused.
# Useful for things like panel/bars that should not dim.
focus-exclude = [
  "class_g = 'Cairo-clock'",
  "class_g = 'bar'", # If you use a custom bar that picom dims
  "class_g = 'slop'",
  "class_g = 'Polybar'",
  "class_g = 'kitty' && window_type = 'notification'", # To keep kitty notifications focused
];

# How frequently to update the compositor's state (in milliseconds).
# Lower values mean more frequent updates but higher CPU usage.
# If you experience tearing or sluggishness, you might adjust this.
# refresh-rate = 0; # Use display's refresh rate.
# refresh-rate = 60; # Specific rate, e.g., 60Hz.

# Force Picom to redraw the entire screen on every frame, even if nothing changed.
# Can increase power usage but sometimes fixes visual glitches.
# force-repaint-each-frame = true;

# Paint on overlay. Might reduce flickering with unredir-if-possible.
# paint-on-overlay = true; # Test this if you see flicker when going fullscreen.

# Log level: "TRACE", "DEBUG", "INFO", "WARN", "ERROR". (Default: "INFO")
log-level = "WARN"; # Keep it low for daily use. Change for debugging.

# Log file. (Default: stderr)
# log-file = "/tmp/picom.log";

# Write process ID to a file.
# write-pid-path = "/tmp/picom.pid";

# Daemonize process. Fork to background after initialization.
# Only use if you start Picom directly (e.g., in .xinitrc or i3 config).
# If your desktop environment (like LXDE, XFCE) manages Picom, it might prefer
# not to daemonize, or it might handle it itself.
daemon = true;


#################################
#         Window Rules          #
#################################

# Override settings for specific windows.
# Format: `KEY = { PROPERTY = VALUE; };`
# Use 'xprop' to find `class_g`, `name`, `window_type`, etc.

wintypes:
{
  tooltip = { fade = true; shadow = true; opacity = 0.85; focus = true; };
  # Notification windows usually don't need shadow or blur, but can fade.
  notification = { fade = true; shadow = false; blur-background = false; };
  # Dock/Panel windows often don't need effects.
  dock = { shadow = false; blur-background = false; };
  # Desktop background often doesn't need effects.
  desktop = { shadow = false; blur-background = false; };
  # Some applications (e.g., games) may bypass the compositor for performance.
  # Set `unredir-if-possible = true;` above for best results with these.
  # Normal windows (most applications)
  normal = { full-shadow = true; };
};
